

<!DOCTYPE html>
<html class="writer-html5" lang="cs" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>6.2. Přizpůsobte místní modely DB &mdash; Dokumentace pro QWAT 1.0</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Rejstřík" href="../genindex.html" />
    <link rel="search" title="Vyhledávání" href="../search.html" />
    <link rel="next" title="6.4. Upgrade databáze" href="upgrade.html" />
    <link rel="prev" title="6.1. Přehled vývoje QWAT" href="qwat_dev.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> QWAT
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../features-guide/index.html">1. QWAT / TEKSI modul pitné vody</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation-guide/index.html">2. Instalační příručka QWAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">3. Uživatelská příručka QWAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">4. Průvodce správce</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributor-guide/index.html">5. Příručka přispěvatele</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">6. Příručka pro vývojáře</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qwat_dev.html">6.1. Přehled vývoje QWAT</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.2. Přizpůsobte místní modely DB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#customizing-the-data-model">6.2.1. Přizpůsobení datového modelu</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-field">6.2.2. Přidání pole</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-a-table">6.2.3. Přidání tabulky</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-an-extension">6.3. Vytvořte rozšíření</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">6.4. Upgrade databáze</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../demo-guide/index.html">7. Ukázková data a projekt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">8. Časté otázky</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary/index.html">9. Slovník</a></li>
<li class="toctree-l1"><a class="reference internal" href="../translation/index.html">10. Překlad</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QWAT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">6. </span>Příručka pro vývojáře</a> &raquo;</li>
        
      <li><span class="section-number">6.2. </span>Přizpůsobte místní modely DB</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/developer-guide/local_customizations.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="customize-local-db-models">
<h1><span class="section-number">6.2. </span>Přizpůsobte místní modely DB<a class="headerlink" href="#customize-local-db-models" title="Permalink to this heading">¶</a></h1>
<p>Od QWAT 1.3.2 byl proces přizpůsobení a rozšíření formalizován.</p>
<p>Rozšíření <strong>je přizpůsobení základního datového modelu</strong>, které je součástí vyhrazeného úložiště. Lze jej kdykoli aktivovat pomocí vlastního inicializačního skriptu. Rozšíření může následovat životní cyklus modelu základních dat, což znamená, že oprava nebo zlepšení rozšíření jádra bude vyžadovat aktualizaci QWAT, ale může mít svůj vlastní životní cyklus. V současné době je jediným rozšířením <a class="reference external" href="https://github.com/qwat/extension_sire">exportní rozšíření SIRE</a>. Všimněte si, že rozšiřuje seznamy hodnot a právě teď je upraveno jádro qwat.</p>
<p>** Místní přizpůsobení ** se bude řídit přesně stejnými pravidly vývoje jako rozšíření, kromě toho, že musí být uloženo v samostatném úložišti, kromě základních adresářů QWAT. lokální přizpůsobení musí být nejprve inicializováno ručně a poté použito v procesu migrace QWAT pomocí specifické volby upgrade_db.sh pro přidání dalších adresářů.</p>
<p>Rozšíření i přizpůsobení vyžadují následující:</p>
<ul class="simple">
<li><p>inicializační skript, který do modelu přidává potřebné informace</p></li>
<li><p>sada aktualizačních skriptů používaných při upgradu základního datového modelu QWAT:</p>
<ul>
<li><p>skript pre-all.py, který nakonec zruší všechna dodatečná zobrazení, spouštěcí funkci nebo jakékoli závislosti, které zamykají aktualizaci datového modelu</p></li>
<li><p>sada souborů SQL s předponou s číslem verze vloženým do verzí jádra datového modelu QWAT (např: 1.3.1.001_local_Pully_script)</p></li>
<li><p>skript post-all.py obnovující potřebné závislosti, jakmile bude použit základní model a rozšíření / přizpůsobení</p></li>
</ul>
</li>
</ul>
<p>Úplný příklad je uveden ve složce  <a class="reference external" href="https://github.com/qwat/qwat-data-model/tree/master/.build/customizations/sigip">.build/customizations/sigip</a> nebo <a class="reference external" href="https://github.com/qwat/extension_sire">SIRE extension</a>.</p>
<section id="customizing-the-data-model">
<h2><span class="section-number">6.2.1. </span>Přizpůsobení datového modelu<a class="headerlink" href="#customizing-the-data-model" title="Permalink to this heading">¶</a></h2>
<p>Tato část se týká modifikace datového modelu pro přidání konkrétních objektů, nahoře na jádrovém datovém modelu QWAT. Přestože existuje plná svoboda při používání funkcí PostGIS a PostgreSQL, zde jsou konvence a osvědčené postupy pro projekt QWAT.</p>
<p>Povolené úpravy pro QWAT jsou:</p>
<ul class="simple">
<li><p>Přidání vlastního pole</p></li>
<li><p>Přidání vlastní tabulky</p></li>
</ul>
<p>Není dovolena žádná změna základního datového modelu (názvy polí, typy, omezení …), nebo byste měli <a class="reference external" href="../contributor-guide/index.html#data-model-changes">požádat o centrální úpravu datového modelu QWAT</a>.</p>
</section>
<section id="adding-a-field">
<h2><span class="section-number">6.2.2. </span>Přidání pole<a class="headerlink" href="#adding-a-field" title="Permalink to this heading">¶</a></h2>
<p>Pokud chcete přidat pole do jedné z tabulek základních datových modelů, postupujte takto</p>
<ul class="simple">
<li><p>Uložte všechny modifikace jako samostatné skripty SQL. NIKDY neupravujte přímo strukturu vaší databáze.</p></li>
<li><p>Každé přidané pole nebo tabulka <strong>musí</strong> mít předponu <cite>usr_</cite></p></li>
<li><p>mějte na paměti, že většina pohledů je generována inicializačním skriptem. Pole bude automaticky přidáno do pohledů, pokud použijete proces inicializace a zahrnutím souboru před a po za účelem přetažení a opětovného vytvoření pohledů.</p></li>
<li><p>Nejjednodušší přístup je ponechat jeden jedinečný skript SQL aplikovaný po všech souborech upgradu základní delty. V současné době (1.3.0) musí být soubor pojmenován jako <cite>vx.x.x</cite> a číslo verze musí být vyšší než nejnovější základní datový model.</p></li>
</ul>
<p>Příklad: přidání informací o barvě barvy do hydrantů</p>
<ul class="simple">
<li><p>1: přidejte atribut s pgadminem (pro úpravu modelu můžete také přímo zadat SQL)</p></li>
<li><p>2: do souboru <cite>usr_model.sql</cite> přidejte následující instrukce ekvivalentní SQL</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">qwat_od</span><span class="p">.</span><span class="n">hydrant</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">usr_color</span><span class="w"> </span><span class="nb">integer</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>3: přidejte následující instrukci SQL do souboru <cite>usr_model_drop.sql</cite></p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">qwat_od</span><span class="p">.</span><span class="n">hydrant</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">usr_color</span><span class="w"> </span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="adding-a-table">
<h2><span class="section-number">6.2.3. </span>Přidání tabulky<a class="headerlink" href="#adding-a-table" title="Permalink to this heading">¶</a></h2>
<p>Vlastní tabulky pasují na konkrétní schémata s předponou <cite>usr_</cite> . Pokud chcete mít další vlastní tabulky, měli byste se nejprve ujistit, že takové vlastní schéma existuje.</p>
<p>Pokud chcete přidat tabulku, postupujte takto</p>
<ul class="simple">
<li><p>Vytvořte vlastní schéma s předponou <cite>usr_</cite></p></li>
<li><p>Přidejte tabulku do tohoto schématu (název tabulky je volitelný)</p></li>
<li><p><strong>Měli byste</strong> zapsat odpovídající rozdílový kód proti základnímu datovému modelu (viz příklad níže)</p></li>
<li><p><strong>Můžete</strong> zapsat odpovídající smazáníí rozdílového kódu proti základnímu datovému modelu (viz příklad níže)</p></li>
</ul>
<p>Příklad: přidání informací o barvě do hydrantů</p>
<ul class="simple">
<li><p>1: přidejte schéma <cite>usr_cityservices</cite> a tabulku <cite>hydrant_paint</cite> s pgadminem (pro úpravu modelu můžete také přímo zadat SQL)</p></li>
<li><p>2: do souboru <cite>usr_model.sql</cite> přidejte následující instrukce ekvivalentní SQL</p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">usr_cityservices</span><span class="p">;</span>
<span class="linenos">2</span><span class="w"> </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usr_cityservices</span><span class="p">.</span><span class="n">hydrant_paint</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">3</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="nb">serial</span>
<span class="linenos">4</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">fk_hydrant</span><span class="w"> </span><span class="nb">integer</span>
<span class="linenos">5</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="nb">varchar</span>
<span class="linenos">6</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">paint_date</span><span class="w"> </span><span class="k">timestamp</span>
<span class="linenos">7</span><span class="p">);</span>
<span class="linenos">8</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usr_cityservices</span><span class="p">.</span><span class="n">hydrant_paint</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">hydrant_fk</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">fk_hydrant</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">qwat_od</span><span class="p">.</span><span class="n">hydrant</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">MATCH</span><span class="w"> </span><span class="k">FULL</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>3: přidejte následující instrukci SQL do souboru <cite>usr_model_drop.sql</cite></p></li>
</ul>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usr_cityservices</span><span class="p">.</span><span class="n">hydrant_paint</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">hydrant_fk</span><span class="p">;</span>
<span class="linenos">2</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usr_cityservices</span><span class="p">.</span><span class="n">hydrant_paint</span><span class="p">;</span>
<span class="linenos">3</span><span class="w"> </span><span class="k">DROP</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">usr_cityservices</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="create-an-extension">
<h1><span class="section-number">6.3. </span>Vytvořte rozšíření<a class="headerlink" href="#create-an-extension" title="Permalink to this heading">¶</a></h1>
<p>Rozšíření mají vyhrazená úložiště jako SIRE Extension. Chcete-li vytvořit rozšíření, musíte vytvořit nové úložiště z <a class="reference external" href="https://github.com/qwat/extension_template">template</a> a pak postupujte podle pokynů.</p>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="upgrade.html" class="btn btn-neutral float-right" title="6.4. Upgrade databáze" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="qwat_dev.html" class="btn btn-neutral float-left" title="6.1. Přehled vývoje QWAT" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, QWAT team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>